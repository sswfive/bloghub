---
title: API设计实践总结
date: 2022-07-06 07:41:15
tags: 
  - 软件工程
---
## API 风格

**业界广泛使用的两种API风格**

* **SOAP**

  * **基于XML格式传输消息**
* **REST API**

  * **使用标准的http协议**
  * **主要用于客户端和服务器交互类的软件，基于这个风格设计的软件可以更简洁、更有层次；**

**REST API 的核心思想：**

**需要明确的是：REST是一种软件架构风格、设计风格、而不是标准；**

* **设计原则和约束条件**

  * **将业务模型抽象成资源；**
  * **保证每一个资源对应一个唯一的资源标识符（URI）；**
  * **对http标准的请求方式对服务器的资源进行操作，实现表现层的状态转化；**
* **基于设计原则和约束条件如何设计API？**

**①：识别资源，每一个URI一般对应领域模型中的一个实体；**

* **URI命名规范：**
  * **全部使用小写字母**
  * **多个单词之间，内部接口使用_连接，浏览器中可展示的URI使用-；**
  * **表示资源合集时，使用复数形式，参数列表要Encode;**

**②：通过标准的HTTP方法表示对资源的操作**

* **GET：查询资源**
* **POST：创建资源**
* **PUT：更新资源**
* **DELETE：删除资源**

```
GET           /api/{资源}/{id}
POST          /api/{资源}
PUT           /api/{资源}/{id}
DELETE        /api/{资源}/{id}
```

* **③：确保API的幂等性**
  * **幂等性的定义：使用同样的参数对同一个API调用一次或多次，对资源状态改变的效果是等价的**
  * **需要注意的是，幂等性不保证反复请求能拿到相同的Response;(如：DELETE操作，第一次返回200表示删除成功，第二次返回404表示资源不存在，这依然是允许的)**

## API单一职责原则

* **如何保证API的职责单一？**

  * **方法一：**
* **依照上述设计原则和约束条件定义好接口后，回头再看看这个接口的功能实现与相应的实体类的相关度，以此再次确认开发好的接口是不是只干一件事，通常这是一种比较有效的方法；**
* **方法二：**
* **首先识别出接口的行为集合，以及这些行为是不是一件事，如果不是一件事，那么可以将这些不同的行为封装听到不同的类或模块中，职责自然而然变得单一了**
* **备注：个人觉得API单一职责在业务系统中往往很难保证；**

## API文档管理

* **业界主流的API文档管理工具**

  * **ShowDoc**
* **只提供展示功能，需要手工录入，功能比较单一**
* **Swagger**
* **提供了一些列注解功能，可以帮助开发者自动生成接口注释，传参要求以及返回示例，还可以进行单个接口的测试。**
* **Yapi**
* **提供了更强大的自定义Mock数据和自动化测试集合的功能，**

## API版本控制

* **需要版本管理的原因：**

  * **软件客户端通常会有很多版本，响应的，服务端的API也需要版本控制来兼容和支持所有客户端版本，此时就需要对API版本进行有效的管理**
* **常用的版本控制策略：**

**方法一：保留老接口，对新版本增加新街口，**

* **优点：职责单一，**
* **缺点：会带来一些代码的重复**

**方法二：使用同一个接口，使用一个版本参数来识别版本信息，在接口实现中对不同版本做出不同的处理；**

* **优缺点和方法一相反**
* **业界流行的方法：**

**①：在URI中直接标记使用哪个版本，无版本URI默认使用最新版本；**

**②：在每个请求后添加一个version参数，表示请求的是哪个版本**

**③：在http请求的header中添加版本信息：**

```
#方法一：
http://apigateway/api/v1/student

#方法二：
http://apigateway/api/student?version=1

# 方法三
Accept: application/json, text/plain, */*
Accept-Encoding: gzip, deflate
Accept-Language: zh-CN,zh;q=0.9
Accept-Version: v2
```
